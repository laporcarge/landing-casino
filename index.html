<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ganamos</title>

  <!-- META Pixel -->
  <script>
    !(function (f, b, e, v, n, t, s) {
      if (f.fbq) return;
      n = f.fbq = function () {
        n.callMethod
          ? n.callMethod.apply(n, arguments)
          : n.queue.push(arguments);
      };
      if (!f._fbq) f._fbq = n;
      n.push = n;
      n.loaded = !0;
      n.version = "2.0";
      n.queue = [];
      t = b.createElement(e);
      t.async = !0;
      t.src = "https://connect.facebook.net/en_US/fbevents.js";
      s = b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t, s);
    })(window, document, "script");

    fbq("init", "1863041204266352");
    fbq("track", "PageView");
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=1863041204266352&ev=PageView&noscript=1"/>
  </noscript>

  <style>
    body {
      font-family: "Inter", sans-serif;
      background: linear-gradient(135deg, #2b1055, #7597de);
      color: white;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .hero {
      background-image: url("img/fondo-casino.jpg");
      background-size: cover;
      background-position: center;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      backdrop-filter: brightness(0.6);
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #fff;
      text-shadow: 0 0 10px #000;
    }
    button {
      background: #00d084;
      border: none;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      padding: 15px 35px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #00b874;
      transform: scale(1.05);
    }
  </style>
</head>

<body>
  <div class="hero">
    <h1>üé∞ HAC√â CLICK EN CONTACTARSE Y COMENZ√Å A GANAR üé∞</h1>
    <button id="btn" onclick="window.open('https://wa.me/5493518055966', '_blank')">CONTACTARSE üí∏</button>
  </div>

  <!-- CAPI Script -->
  <script>
    // helper cookie
    function getCookie(name) {
      const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
      return m ? m.pop() : "";
    }

    // crea cookie _fbc si hay fbclid
    (function ensureFbcFromFbclid(){
      const params = new URLSearchParams(window.location.search);
      const fbclid = params.get('fbclid');
      if (fbclid && !getCookie('_fbc')) {
        const fbc = `fb.1.${Date.now()}.${fbclid}`;
        document.cookie = `_fbc=${fbc}; path=/; max-age=${60*60*24*90}`;
      }
    })();

    async function sendCapiContact() {
      const fbp = getCookie('_fbp') || "";
      const fbc = getCookie('_fbc') || "";
      const event_id = `${Date.now()}-${Math.random().toString(36).slice(2)}`;

      // pixel (cliente)
      if (typeof fbq !== "undefined") {
        fbq("track", "Contact", {}, { eventID: event_id });
      }

      // evento servidor (CAPI)
      try {
        await fetch("/api/meta-capi", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            event_name: "Contact",
            event_id,
            fbp,
            fbc,
            event_source_url: location.href,
          }),
        });
        console.log("‚úÖ Evento Contact enviado por CAPI");
      } catch (err) {
        console.warn("CAPI send error:", err);
      }
    }

    document.getElementById("btn").addEventListener("click", sendCapiContact);
  </script>
</body>
</html>
